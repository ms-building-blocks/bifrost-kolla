---
##
# Gen SSH keys if not exists
##
- name: Generate SSH keys
  shell: ssh-keygen -b 2048 -t rsa -f /root/.ssh/id_rsa -q -N ""
  args:
    creates: /root/.ssh/id_rsa

##
# Clean and install packages get Bifrost sources
##
- name: install packages
  import_tasks: install_DEBIAN.yaml
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'

##
# Create an OPNFV user
##
- user:
    name: opnfv
    comment: "OPNFV ops"
    group: admin
    generate_ssh_key: yes
- name: copy certs
  copy:
    src: "/root/ssh/{{ item }}"
    dest: "/home/opnfv/.ssh/{{ item }}"
    owner: opnfv
    group: opnfv
  with_items:
    - 'id_rsa'
    - 'id_rsa.pub'
