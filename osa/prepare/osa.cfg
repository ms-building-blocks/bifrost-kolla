{% set itf = macs[nodes[srv].macs[net_config[bridge].interface]] %}
{% if net_config[bridge].vlan > 0 %}
auto {{ itf }}.{{ net_config[bridge].vlan }}
iface {{ itf }}.{{ net_config[bridge].vlan }} inet manual
    vlan-raw-device {{ itf }}
{% else %}
auto {{ itf }}
iface {{ itf }} inet manual
{% endif %}

auto {{ bridge }}
iface {{ bridge }} inet static
    bridge_stp off
    bridge_waitport 0
    bridge_fd 0
    bridge_ports {{ itf }}{% if net_config[bridge].vlan > 0 %}.{{ net_config[bridge].vlan }}{% endif %}

{% if bridge != 'br-vlan' %}
    address {{ net_config[bridge].network.split('.')[0:-1]|join('.') }}.20{{ nodes[srv].id }}
    netmask {{ net_config[bridge].mask }}
{% if bridge == 'br-mgmt' %}
    gateway {{ net_config[bridge].gateway }}
    dns-nameservers {{ net_config[bridge].dns }}
{% endif %}
{% endif %}
