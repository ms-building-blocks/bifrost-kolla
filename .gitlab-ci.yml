---
stages:
  - syntax_checking
  - deploy

syntax_checking:
  stage: syntax_checking
  image: dockerproxy-iva.si.francetelecom.fr/debian:latest
  tags:
    - shared
    - docker
    - innovation
  script:
    - apt-get update -qq
    - apt-get install -y -qq yamllint python3-pkg-resources
    - yamllint *.y?ml
    - yamllint vars/
    - yamllint roles/*/tasks/*.y?ml


### A travailler
deploy:
  stage: deploy
  tags:
    - sina
  variables:
    pod: pod1
    target_folder: /opt/bosa
    terrahouat_raw:
      https://gitlab.forge.orange-labs.fr/opnfv/TerraHouat/raw/master
  script:
    - wget -O vars/pdf.yaml ${terrahouat_raw}/config/${pod}.yaml
    - wget -O vars/idf.yaml ${terrahouat_raw}/config/idf-${pod}.yaml
    - rsync --cvs-exclude -e ssh -avz  --delete-after . ${pod}.opnfv.fr:${target_folder}
    - ssh ${pod}.opnfv.fr "cd /opt/bosa; sudo ./run.sh orange ${pod}"
